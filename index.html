<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <title>E-Voting OSIS 2026</title>
    <link rel="stylesheet" href="style.css">
    <style>
        /* Tambahan style untuk preview otomatis */
        .preview-box {
            background: #f8fafc;
            border-radius: 8px;
            padding: 10px;
            margin-top: 10px;
            border: 1px solid #e2e8f0;
            text-align: left;
        }
        .hidden { display: none; }
    </style>
</head>
<body>

<div class="container">
    <div id="login-page" class="login-box">
        <h2 style="color: #1e293b; margin-bottom: 0.5rem;">E-Voting OSIS</h2>
        <p style="color: #64748b; margin-bottom: 2rem;">Silahkan login menggunakan NISN Anda</p>
        
        <div class="input-group">
            <label>NISN Siswa</label>
            <input type="text" id="nisn-field" placeholder="Masukkan 5 digit NISN..." oninput="cekNISNOtomatis()">
        </div>

        <div id="preview-user" class="preview-box hidden">
            <small style="color: #64748b;">Data ditemukan:</small>
            <div id="preview-nama" style="font-weight: bold; color: #1e293b;"></div>
            <div id="preview-kelas" style="font-size: 0.9rem; color: #64748b;"></div>
        </div>

        <button class="btn" style="margin-top: 20px;" onclick="prosesLogin()">Masuk</button>
        <p id="error-msg" style="color: red; margin-top: 10px;" class="hidden"></p>
    </div>

    <div id="vote-page" class="hidden">
        <div style="border-bottom: 2px solid #f1f5f9; padding-bottom: 1rem; margin-bottom: 2rem;">
            <h3 id="display-nama" style="margin:0">Nama Siswa</h3>
            <p id="display-kelas" style="color: #64748b; margin:0">Kelas</p>
        </div>

        <h2 style="text-align: center;">Kandidat Ketua & Wakil Ketua OSIS</h2>
        
        <div class="grid-paslon">
            <div class="card">
                <img src="https://via.placeholder.com/400x300?text=Paslon+01" alt="Paslon 1">
                <div class="card-content">
                    <h3>01. Aris & Linda</h3>
                    <p>"Menciptakan lingkungan sekolah yang kreatif dan berbasis teknologi."</p>
                    <button class="btn btn-vote" onclick="simpanSuara('Paslon 01')">Pilih Paslon 01</button>
                </div>
            </div>
            <div class="card">
                <img src="https://via.placeholder.com/400x300?text=Paslon+02" alt="Paslon 2">
                <div class="card-content">
                    <h3>02. Dedi & Sinta</h3>
                    <p>"Mengutamakan kedisiplinan dan solidaritas antar ekstrakurikuler."</p>
                    <button class="btn btn-vote" onclick="simpanSuara('Paslon 02')">Pilih Paslon 02</button>
                </div>
            </div>
        </div>
    </div>

    <div id="thanks-page" class="hidden" style="text-align: center;">
        <h1 style="font-size: 4rem;">ðŸŽ‰</h1>
        <h2>Terima Kasih!</h2>
        <p>Suara Anda sangat berarti bagi kemajuan sekolah.</p>
        <p>Sistem akan kembali ke halaman login dalam 3 detik...</p>
    </div>
</div>

<script>
    const daftarSiswa = [
        { nisn: "22001", nama: "Budi Santoso", kelas: "X MIPA 1" },
        { nisn: "22002", nama: "Siti Aminah", kelas: "XI IPS 2" },
        { nisn: "22003", nama: "Rizky Pratama", kelas: "XII MIPA 4" },
        { nisn: "22004", nama: "Dewi Lestari", kelas: "X IPS 1" },
        { nisn: "22005", nama: "Andi Wijaya", kelas: "XII IPS 3" }
    ];

    let userAktif = null;

    // FUNGSI BARU: Deteksi otomatis saat mengetik
    function cekNISNOtomatis() {
        const nisnInput = document.getElementById('nisn-field').value;
        const previewBox = document.getElementById('preview-user');
        const previewNama = document.getElementById('preview-nama');
        const previewKelas = document.getElementById('preview-kelas');
        const errorMsg = document.getElementById('error-msg');

        // Cari siswa berdasarkan input
        const siswa = daftarSiswa.find(s => s.nisn === nisnInput);

        if (siswa) {
            // Jika ketemu, tampilkan profil singkat
            previewNama.innerText = siswa.nama;
            previewKelas.innerText = siswa.kelas;
            previewBox.classList.remove('hidden');
            errorMsg.classList.add('hidden'); // Sembunyikan error jika sebelumnya ada
        } else {
            // Jika tidak ketemu atau dihapus, sembunyikan profil
            previewBox.classList.add('hidden');
        }
    }

    function prosesLogin() {
        const nisnInput = document.getElementById('nisn-field').value;
        const errorMsg = document.getElementById('error-msg');
        
        const siswa = daftarSiswa.find(s => s.nisn === nisnInput);
        const sudahMemilih = localStorage.getItem('voted_' + nisnInput);

        if (!siswa) {
            errorMsg.innerText = "NISN tidak terdaftar!";
            errorMsg.classList.remove('hidden');
        } else if (sudahMemilih) {
            errorMsg.innerText = "Maaf, NISN ini sudah digunakan untuk memilih!";
            errorMsg.classList.remove('hidden');
        } else {
            userAktif = siswa;
            document.getElementById('display-nama').innerText = siswa.nama;
            document.getElementById('display-kelas').innerText = siswa.kelas;
            
            document.getElementById('login-page').classList.add('hidden');
            document.getElementById('vote-page').classList.remove('hidden');
        }
    }

    function simpanSuara(pilihan) {
        if(confirm(`Yakin ingin memilih ${pilihan}?`)) {
            localStorage.setItem('voted_' + userAktif.nisn, "true");
            let suaraSekarang = JSON.parse(localStorage.getItem('rekap_suara')) || { "Paslon 01": 0, "Paslon 02": 0 };
            suaraSekarang[pilihan] += 1;
            localStorage.setItem('rekap_suara', JSON.stringify(suaraSekarang));

            document.getElementById('vote-page').classList.add('hidden');
            document.getElementById('thanks-page').classList.remove('hidden');

            setTimeout(() => { location.reload(); }, 3000);
        }
    }
</script>
</body>
</html>
