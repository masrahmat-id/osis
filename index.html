<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <title>E-Voting OSIS 2026</title>
    <link rel="stylesheet" href="style.css">
    <style>
        input:readonly {
            background-color: #f1f5f9;
            color: #475569;
            cursor: not-allowed;
        }
        .hidden { display: none; }
        
        /* CSS Tambahan sederhana jika belum ada style.css */
        .container { font-family: sans-serif; max-width: 800px; margin: 2rem auto; padding: 1rem; }
        .input-group { margin-bottom: 1rem; }
        .input-group label { display: block; margin-bottom: 5px; }
        .input-group input { width: 100%; padding: 8px; box-sizing: border-box; }
        .btn { padding: 10px 20px; background: #2563eb; color: white; border: none; border-radius: 5px; cursor: pointer; }
        .grid-paslon { display: flex; gap: 20px; justify-content: center; margin-top: 20px; }
        .card { border: 1px solid #ddd; border-radius: 10px; overflow: hidden; width: 300px; text-align: center; }
        .card img { width: 100%; height: auto; }
        .card-content { padding: 15px; }
    </style>
</head>
<body>

<div class="container">
    <div id="login-page" class="login-box">
        <h2 style="color: #1e293b; margin-bottom: 0.5rem;">E-Voting OSIS</h2>
        <p style="color: #64748b; margin-bottom: 2rem;">Silahkan login menggunakan NISN Anda</p>
        
        <div class="input-group">
            <label>NISN Siswa</label>
            <input type="text" id="nisn-field" placeholder="Masukkan 5 digit NISN..." oninput="cekNISN()">
        </div>

        <div class="input-group">
            <label>Nama Siswa (Otomatis)</label>
            <input type="text" id="auto-nama" placeholder="-" readonly>
        </div>

        <div class="input-group">
            <label>Kelas (Otomatis)</label>
            <input type="text" id="auto-kelas" placeholder="-" readonly>
        </div>
        
        <button class="btn" id="btn-masuk" onclick="prosesLogin()" disabled style="opacity: 0.5; cursor: not-allowed;">Masuk</button>
        <p id="error-msg" style="color: red; margin-top: 10px;" class="hidden"></p>
    </div>

    <div id="vote-page" class="hidden">
        <div style="border-bottom: 2px solid #f1f5f9; padding-bottom: 1rem; margin-bottom: 2rem;">
            <h3 id="display-nama" style="margin:0">Nama Siswa</h3>
            <p id="display-kelas" style="color: #64748b; margin:0">Kelas</p>
        </div>

        <h2 style="text-align: center;">Kandidat Ketua & Wakil Ketua OSIS</h2>
        
        <div class="grid-paslon">
            <div class="card">
                <img src="https://via.placeholder.com/400x300?text=Paslon+01" alt="Paslon 1">
                <div class="card-content">
                    <h3>01. Aris & Linda</h3>
                    <p>"Menciptakan lingkungan sekolah yang kreatif dan berbasis teknologi."</p>
                    <button class="btn btn-vote" onclick="simpanSuara('Paslon 01')">Pilih Paslon 01</button>
                </div>
            </div>
            <div class="card">
                <img src="https://via.placeholder.com/400x300?text=Paslon+02" alt="Paslon 2">
                <div class="card-content">
                    <h3>02. Dedi & Sinta</h3>
                    <p>"Mengutamakan kedisiplinan dan solidaritas antar ekstrakurikuler."</p>
                    <button class="btn btn-vote" onclick="simpanSuara('Paslon 02')">Pilih Paslon 02</button>
                </div>
            </div>
        </div>
    </div>

    <div id="thanks-page" class="hidden" style="text-align: center;">
        <h1 style="font-size: 4rem;">ðŸŽ‰</h1>
        <h2>Terima Kasih!</h2>
        <p>Suara Anda sangat berarti bagi kemajuan sekolah.</p>
        <p>Sistem akan kembali ke halaman login dalam 3 detik...</p>
    </div>
</div>

<script>
    const daftarSiswa = [
        { nisn: "22001", nama: "Budi Santoso", kelas: "X MIPA 1" },
        { nisn: "22002", nama: "Siti Aminah", kelas: "XI IPS 2" },
        { nisn: "22003", nama: "Rizky Pratama", kelas: "XII MIPA 4" },
        { nisn: "22004", nama: "Dewi Lestari", kelas: "X IPS 1" },
        { nisn: "22005", nama: "Andi Wijaya", kelas: "XII IPS 3" }
    ];

    let userAktif = null;

    function cekNISN() {
        const nisnInput = document.getElementById('nisn-field').value;
        const autoNama = document.getElementById('auto-nama');
        const autoKelas = document.getElementById('auto-kelas');
        const btnMasuk = document.getElementById('btn-masuk');
        const errorMsg = document.getElementById('error-msg');

        const siswa = daftarSiswa.find(s => s.nisn === nisnInput);

        if (siswa) {
            autoNama.value = siswa.nama;
            autoKelas.value = siswa.kelas;
            btnMasuk.disabled = false;
            btnMasuk.style.opacity = "1";
            btnMasuk.style.cursor = "pointer";
            errorMsg.classList.add('hidden');
        } else {
            autoNama.value = "";
            autoKelas.value = "";
            btnMasuk.disabled = true;
            btnMasuk.style.opacity = "0.5";
            btnMasuk.style.cursor = "not-allowed";
            
            if(nisnInput.length >= 5) {
                errorMsg.innerText = "NISN tidak terdaftar!";
                errorMsg.classList.remove('hidden');
            } else {
                errorMsg.classList.add('hidden');
            }
        }
    }

    function prosesLogin() {
        const nisnInput = document.getElementById('nisn-field').value;
        const errorMsg = document.getElementById('error-msg');
        const siswa = daftarSiswa.find(s => s.nisn === nisnInput);
        const sudahMemilih = localStorage.getItem('voted_' + nisnInput);

        if (sudahMemilih) {
            errorMsg.innerText = "Maaf, NISN ini sudah digunakan untuk memilih!";
            errorMsg.classList.remove('hidden');
        } else {
            userAktif = siswa;
            document.getElementById('display-nama').innerText = siswa.nama;
            document.getElementById('display-kelas').innerText = siswa.kelas;
            document.getElementById('login-page').classList.add('hidden');
            document.getElementById('vote-page').classList.remove('hidden');
        }
    }

    // FUNGSI SIMPAN SUARA (SUDAH DIPERBARUI: TANPA KONFIRMASI)
    function simpanSuara(pilihan) {
        // Langsung simpan status sudah memilih
        localStorage.setItem('voted_' + userAktif.nisn, "true");
        
        // Update rekap suara di localStorage
        let suaraSekarang = JSON.parse(localStorage.getItem('rekap_suara')) || { "Paslon 01": 0, "Paslon 02": 0 };
        suaraSekarang[pilihan] += 1;
        localStorage.setItem('rekap_suara', JSON.stringify(suaraSekarang));

        // Pindah ke halaman terima kasih
        document.getElementById('vote-page').classList.add('hidden');
        document.getElementById('thanks-page').classList.remove('hidden');

        // Reset halaman setelah 3 detik
        setTimeout(() => { location.reload(); }, 3000);
    }
</script>
</body>
</html>
